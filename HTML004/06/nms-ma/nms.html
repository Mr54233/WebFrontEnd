<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>基于vue-router的案例</title>
    <style type="text/css">
      html,
      body,
      #app {
        margin: 0;
        padding: 0px;
        height: 100%;
      }
      .header {
        height: 50px;
        background-color: #545c64;
        line-height: 50px;
        text-align: center;
        font-size: 24px;
        color: #fff;
      }
      .footer {
        height: 40px;
        line-height: 40px;
        background-color: #888;
        position: absolute;
        bottom: 0;
        width: 100%;
        text-align: center;
        color: #fff;
      }
      .main {
        display: flex;
        position: absolute;
        top: 50px;
        bottom: 40px;
        width: 100%;
      }
      .content {
        flex: 1;
        text-align: center;
        height: 100%;
      }
      .left {
        flex: 0 0 20%;
        background-color: #545c64;
      }
      .left a {
        color: white;
        text-decoration: none;
      }
      .right {
        margin: 5px;
      }
      .btns {
        width: 100%;
        height: 35px;
        line-height: 35px;
        background-color: #f5f5f5;
        text-align: left;
        padding-left: 10px;
        box-sizing: border-box;
      }
      button {
        height: 30px;
        background-color: #ecf5ff;
        border: 1px solid lightskyblue;
        font-size: 12px;
        padding: 0 20px;
      }
      .main-content {
        margin-top: 10px;
      }
      ul {
        margin: 0;
        padding: 0;
        list-style: none;
      }
      ul li {
        height: 45px;
        line-height: 45px;
        background-color: #a0a0a0;
        color: #fff;
        cursor: pointer;
        border-bottom: 1px solid #fff;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      td,
      th {
        border: 1px solid #eee;
        line-height: 35px;
        font-size: 12px;
      }

      th {
        background-color: #ddd;
      }
    </style>    
  </head>
  <body>
     <div id="app">        
        <router-view />
     </div>
     
     
     
     <script src="../js/vue.js"></script>
     <script src="../js/vue-router_3.0.2.js"></script>
     <script>
        // 封装APP组件
        const App = {
          template:`
            <div>
              <!-- 头部区域 -->
              <header class="header">后台管理系统</header>
              <!-- 中间主体区域 -->
              <div class="main">
                <!-- 左侧菜单栏 -->
                <div class="content left">
                  <ul>
                    <li><router-link to="/categories">类型管理</router-link></li>                    
                  </ul>
                </div>
                <!-- 右侧内容区域 -->
                <div class="content right">
                   <router-view></router-view>
                </div>
              </div>
              <!-- 尾部区域 -->
              <footer class="footer">版权信息</footer>
            </div>
          `
        }

        // 类型管理的组件(表格方式显示类型数据)
        const Category = {
          data(){
            return {
              categories:[]
            }
          },
          template:`
              <div>
                <table>
                  <thead>
                    <tr><th>类型编号</th><th>类型名称</th><th>操作</th></tr>
                  </thead>
                  <tbody>
                    <tr v-for="category in categories">
                      <td>{{category.cid}}</td>
                      <td>{{category.cname}}</td>
                      <td>
                        <a href="javascript:;" @click="goEdit(category.cid)">编辑</a>
                        <a href="javascript:;">删除</a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
          `,
          methods:{
            goEdit(id){
              this.$router.push({name:'ec',params:{cid:id}});
            }
          },
          mounted(){
            // 在mounted钩子函数中进行模型数据的初始化
            fetch('http://localhost:3000/api/category/page')
            .then(result=>{
              return result.json();
            }).then(json=>{
              // 将json对象中的data属性中的所有类型数据赋值给模型数据
              this.categories = json.data;
            })
          }
        }

        const EditCategory = {
          props:['cid'],
          data(){
            return {
              category:{}
            }
          },
          template:`
              <div>
                <form>
                  <div class="formitem">
                    <span>类型编号</span>
                    <input type="text" v-model = "category.cid">
                  </div>
                  <div class="formitem">
                    <span>类型名称</span>
                    <input type="text" v-model = "category.cname">
                  </div>
                  <div class="formitem">
                    <span>&nbsp;</span>
                    <input type="button" value="保存" @click="save">
                  </div>
                </form>
              </div>
          `,
          methods:{

            save() {
              var info = `cid=${this.category.cid}&cname=${this.category.cname}`;
              fetch('http://localhost:3000/api/category/save',{
                method:'post',
                body:info,
                headers:{'Content-Type':'application/x-www-form-urlencoded'}
              }).then(result=>{
                return result.json();
              }).then(json=>{
                this.$router.go(-1);
              })
            }
          },
          mounted(){
            // 根据cid获取到需要修改的类型数据
            fetch('http://localhost:3000/api/category/getSingle?cid='+this.cid)
            .then(result=>{              
              return result.json();
            })              
            .then(json=>{
              this.category = json.data;              
            })
          }
        }

        
        const router = new VueRouter({
          routes:[            
            { path:'/',component:App,children:[
              { path:'/categories',component:Category },
              { path:'/editCategory/:cid',name:"ec",component:EditCategory,props:true }
              
            ]}            
          ]
        })

        const vm = new Vue({
          el:'#app',
          router
        })
     </script>
  </body>
</html>
